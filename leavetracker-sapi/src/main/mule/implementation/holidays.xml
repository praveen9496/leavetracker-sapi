<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:db="http://www.mulesoft.org/schema/mule/db" xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
	xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
http://www.mulesoft.org/schema/mule/db http://www.mulesoft.org/schema/mule/db/current/mule-db.xsd">
	<sub-flow name="post-holidaySub_Flow" doc:id="44c7f281-0757-4172-93b5-4ce18283df26" >
		<set-payload value="#[%dw 2.0&#10;output application/json&#10;---&#10;payload map {date: $.Date ,&#10;holiday: $.Holiday}]" doc:name="input parameters" doc:id="cff7dad5-ebc6-4a97-a29b-e24c6eac4738" />
		<until-successful maxRetries="${until.retries}" doc:name="Until Successful" doc:id="1e81eae8-a65d-40b1-ac52-d9c71dedfef9" millisBetweenRetries="${until.millisecs}">
			<try doc:name="Try" doc:id="fffa7419-adff-4ead-9e17-ede2242910d0">
				<db:bulk-insert doc:name="Bulk inserting the holidays" doc:id="d1e1c8ae-9037-433b-b2cc-3706ce2088d9" config-ref="Database_Config">
					<db:sql ><![CDATA[INSERT INTO public.holidays (holiday, h_date) VALUES(:holiday, :date);]]></db:sql>
				</db:bulk-insert>
				<set-payload value='#[%dw 2.0&#10;output application/json&#10;---&#10;{&#10;  message: "Holidays posted"&#10;}]' doc:name="response" doc:id="fdc01a26-cb48-45ff-bb03-09fafb551dc8" />
				<error-handler ref="db-errorHandler" />
		</try>
		</until-successful>
	</sub-flow>
	<sub-flow name="get-holidaySub_Flow" doc:id="07bf859d-7aee-47e7-9497-b4ca41339ac1" >
		<until-successful maxRetries="5" doc:name="Until Successful" doc:id="e4db4689-1c84-48ce-99c0-0a057a3520fb" >
			<try doc:name="Try" doc:id="40c58100-4362-433d-a0c3-8a7c7ea052db">
			<db:select doc:name="fetch holidays list from db" doc:id="c425ec7f-ce96-4b78-979c-b1f39269d926" config-ref="Database_Config">
			<db:sql><![CDATA[#[payload]]]></db:sql>
			<db:input-parameters><![CDATA[#[{date:vars.date}]]]></db:input-parameters>
		</db:select>
				<set-payload value="#[%dw 2.0&#10;output application/json&#10;---&#10;payload]" doc:name="response" doc:id="e2fdd6cf-b394-4358-a2b5-bceb96055692" />
				<error-handler ref="db-errorHandler" />
		</try>
		</until-successful>
	</sub-flow>
</mule>
